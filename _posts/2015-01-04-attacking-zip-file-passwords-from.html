---
layout: posts
title: "Attacking Zip File Passwords from the Command Line"
date: '2015-01-04T11:30:00.000+09:00'
author: Joshua
tags:
- Password Cracking
- Encryption
- HowTo
modified_time: '2015-08-24T22:35:19.151+09:00'
thumbnail: http://2.bp.blogspot.com/-WGf9KhJiN40/U9TiU7AzjFI/AAAAAAAAAzg/Zj_86E69MxE/s72-c/jtr.png
blogger_id: tag:blogger.com,1999:blog-2701259639305045003.single-355898867505183737
blogger_orig_url: https://DFIR.Science/2015/01/attacking-zip-file-passwords-from.html
---

There was recently a <a href="https://superuser.com/questions/852141/john-the-ripper-crack-zipcrypto-password/859930#859930" target="_blank">question on SuperUser</a> linking back to CybercrimeTech's article about cracking passwords, with an issue about zip files using ZipCrypto, and never finding the password. I left an answer, saying that I guess zip2john does not know how to accurately extract the hash from zip files using that particular algorithm.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-WGf9KhJiN40/U9TiU7AzjFI/AAAAAAAAAzg/Zj_86E69MxE/s1600/jtr.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://2.bp.blogspot.com/-WGf9KhJiN40/U9TiU7AzjFI/AAAAAAAAAzg/Zj_86E69MxE/s1600/jtr.png" height="181" width="200" /></a></div>In such a case, you can either 1) figure out the data structure, and update zip2john (<a href="https://github.com/magnumripper/JohnTheRipper">https://github.com/magnumripper/JohnTheRipper</a>), or use the same approach that we <a href="https://DFIR.Science/2014/08/how-to-brute-forcing-password-cracking.html" target="_blank">have used before with LUKS</a>&nbsp;to attack the file directly from the command line.<br /><br />Definitely, attempting to crack the hash is faster, but if you are stuck and don't have time to reverse engineer a new file type, this would *eventually* work for you.<br /><br />See the code below as an example of having John generate the password then passing it to 7zip to try. This should work regardless of chosen encryption, unless you have to specify it when opening the archive. It is not clean, but it should be enough to illustrate.<br /><br /><code>&nbsp; &nbsp; #!/bin/bash<br />&nbsp; &nbsp; # Using john the ripper to brute-force a zip container<br />&nbsp; &nbsp; startTime=$(date)<br />&nbsp; &nbsp; if [ $(file $1 | grep -c "Zip archive data") ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; john -i --stdout | while read i; do &nbsp; # this is john generating password to stdout<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo -ne "\rtrying \"$i\" "\\r<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7z -p$i -so e $1 2&gt;&amp;1&gt; /dev/null &nbsp; &nbsp; # this is your zip command<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS=$?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if [ $STATUS -eq 0 ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo -e "\nPassword is: \"$i\"<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # if successful, print the password and quit<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; &nbsp; &nbsp; done<br />&nbsp; &nbsp; &nbsp; &nbsp; echo "Start time $startTime"<br />&nbsp; &nbsp; &nbsp; &nbsp; echo "End time $(date)"<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; echo "The file does not appear to be a zip file"<br />&nbsp; &nbsp; fi<br /></code><br /><br />This approach should work when you are unable to extract the hash, but is much, much slower (not really practical for most applications). See the results below.<br /><br /><code>&nbsp; &nbsp; ...<br />&nbsp; &nbsp; trying "pmc"<br />&nbsp; &nbsp; 7-Zip [64] 9.20 &nbsp;Copyright (c) 1999-2010 Igor Pavlov &nbsp;2010-11-1<br />&nbsp; &nbsp; Processing archive: test.zip<br />&nbsp; &nbsp; Extracting &nbsp;Sample_memo.pdf &nbsp; &nbsp; Data Error in encrypted file. Wrong password?<br />&nbsp; &nbsp; **Sub items Errors: 1**<br />&nbsp; <br />&nbsp; &nbsp; trying "1234"<br />&nbsp; &nbsp; 7-Zip [64] 9.20 &nbsp;Copyright (c) 1999-2010 Igor Pavlov &nbsp;2010-11-18<br />&nbsp; &nbsp; Processing archive: test.zip<br />&nbsp; &nbsp; Extracting &nbsp;Sample_memo.pdf<br />&nbsp; &nbsp; **Everything is Ok**<br />&nbsp; &nbsp; Size: &nbsp; &nbsp; &nbsp; 60936<br />&nbsp; &nbsp; Compressed: 51033<br />&nbsp; <br />&nbsp; &nbsp; Password is: "1234"<br />&nbsp; &nbsp; Start time 2015. 01. 03. (토) 19:02:51 KST<br />&nbsp; &nbsp; End time 2015. 01. 03. (토) 19:02:51 KST </code>