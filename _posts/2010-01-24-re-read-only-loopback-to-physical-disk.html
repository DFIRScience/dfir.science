---
layout: single
title: "RE: Read-Only Loopback to Physical Disk"
date: '2010-01-24T23:05:00.000+09:00'
author: Joshua
tags:
- HowTo
modified_time: '2015-08-24T22:35:19.158+09:00'
blogger_id: tag:blogger.com,1999:blog-2701259639305045003.single-3882041777727263249
blogger_orig_url: https://DFIR.Science/2010/01/re-read-only-loopback-to-physical-disk.html
---

A reader sent a very informative email in reply to <a href="https://DFIR.Science/2009/10/read-only-loopback-to-physical-disk.html">this</a> single about <a href="https://DFIR.Science/2009/10/read-only-loopback-to-physical-disk.html">Read-Only Loopback Devices</a>.<br /><br /><a href="http://www.denisfrati.it/pdf/Linux_for_computer_forensic_investigators.pdf">http://www.denisfrati.it/pdf/Linux_for_computer_forensic_investigators.pdf</a> has the results of some research which was done into various "forensic" Linux boot CDs.<br /><br />&gt;For mounting a drive under Linux you have the<br />&gt;standard 'mount' command. When mounting you can specify the -o ro<br />&gt;option, which theoretically puts you in a safe read-only state... or<br />&gt;does it? Does it always work? Does it stop everything?<br /><br />It definitely does not always work. For example, partitions which use a journalling filesystem. The filesystem replays the journal on the disk (i.e. writes to the disk) even if "ro" is specified. For ext3, the "noload" option is supposed to prevent that happening. For XFS there is "norecovery" and for NTFS-3G there is "norecover".<br /><br />IMO that's a terrible design decision; apart from the needlessly-differing option names, no writes at all should be done when "ro" is specified. (Maybe "forceload"/"forcerecovery" mount options could be used if the user for some reason does want to replay the journal and mount ro.)<br /><br />It's all too easy to forget and end up writing to the disk.<br /><br />&gt;Another option that I recently found was the 'blockdev' command. You can specify that the blockdev is ro even before mounting.<br />&gt;blockdev --report<br />&gt;blockdev --setro /dev/device<br />&gt;But<br />&gt;my professor brought up the point - these probably depend on the driver<br />&gt;used. Maybe a driver for ntfs totally ignores the ro switch? I don't<br />&gt;totally agree that blockdev would be based on the driver, but how do<br />&gt;you test whether the drive actually is in ro without writing? What if<br />&gt;it fails?<br /><br />Well, the filesystem code will (or *should*) go through the block layer, so using blockdev --setro should be effective. However, partitions don't seem to inherit the read-only flag! In other words, if you have a hard disk /dev/sda with a single partition /dev/sda1, you can do<br />blockdev --setro /dev/sda<br />but if you then do<br />blockdev --getro /dev/sda1<br />you'll notice that sda1's read-only flag is not set! I haven't verified yet whether sda1 can be written to in those circumstances.<br /><br />That doesn't of course prevent writes by the underlying driver (i.e. SCSI). You just have to trust that the underlying driver won't do that. (But in theory a badly-written low-level driver might. E.g. to detect whether the medium is write-protected, the driver could read a sector and attempt to write it back.)<br /><br />Any forensic Linux distribution should by default create all (disk) device nodes with the read-only flag set. That should provide another layer of confidence, in that the user must manually "blockdev --setrw /dev/name" before being able to write to the device. Apparently grml (in forensic mode) does that.<br /><br />&gt;Then the saving grace - loopback devices. Mount the partition as a file. You don't need to worry about drivers, support, etc.<br />&gt;To do this use losetup to create a loopback device:<br />&gt;losetup -r /dev/loop1 /dev/hda1This creates a read-only loopback device pointing to /dev/hda1<br />&gt;Then you can mount the loopback device (read-only if you are paranoid)<br />&gt;mount -o ro /dev/loop1 /media/testThis mounts the loopback device loop1 at /media/test. You can then traverse the directory of /dev/hda1 just like it was mounted.<br /><br />According to the PDF document I mentioned above, doing this:<br />mount -o ro,loop /dev/hda1 /media/test<br />should work in a similar way. (But to be sure, you'd need to check the source to see whether mount passes the "-r" option to losetup if ro and loop are specified...)<br /><br />Ideally, anyone creating a forensic Linux distribution would test it when booting with disks which have "dirty" journals. Are there any hardware write-blocker products which will e.g. sound a buzzer when any write is attempted?<br /><br />Thanks of the comments Mark!