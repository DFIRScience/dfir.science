---
layout: posts
title: Creating and Configuring a Large Redundant Storage Array for a Network Share
  in Ubuntu using MDADM
date: '2012-09-21T18:12:00.000+09:00'
author: Joshua
tags:
- Storage
- HowTo
modified_time: '2015-08-24T22:35:19.320+09:00'
blogger_id: tag:blogger.com,1999:blog-2701259639305045003.single-7088336921913205416
blogger_orig_url: https://DFIR.Science/2012/09/creating-and-configuring-large.html
---

<div>We had a hardware RAID card that worked well in Windows, but was giving some issues in Linux (Ubuntu 12.04). So, we decided to try to setup a software array using mdadm. This is how we did it.</div><div><br /></div><div>First, make sure your hardware RAID card has "non-RAID" mode. Basically that it lets each of the attached drives show up as a single drive. Ensure this is enabled. On some cards you will have to flash the BIOS with a non-RAID version.</div><ul><li>Do not create a hardware RAID array using the RAID configuration menu</li><li>Make sure no drives are assigned to a RAID array</li><li>Install the newest version of Ubuntu Server</li><ul><li>When asked for partitioning information</li><li>Select manual partitioning</li><li>Select "Create Software RAID”</li><li>“Create MD device”</li><li>Select RAID5 &nbsp; (we are using RAID5)</li><li>Active devices = # &nbsp; (where # is the number of drives you want in the array)</li><li>Spare devices = #</li><li>Select all the drives you want in the array</li><li>Select OK</li></ul></ul>After the array is created our new device has about 21TB. In versions of Ubuntu before 12.04 it was difficult to create a partition using the whole 21TB, but now you should be able to do it from the install menu.<br /><ul><li>Create a partition on the newly created device (usually md0)</li><li>Format as ext4</li><li>Save and continue with install per usual</li><ul><li>You might want to select “ssh” from the package selection</li></ul></ul>Once install is done, and you boot into the OS:<br /><ul><li>Make sure array device has been created</li><ul><li>Sudo fdisk –l</li><li>Look for /dev/md0</li></ul><li>Check status of the software array</li><ul><li>Sudo mdadm --detail /dev/md0</li><li>If the status of the array is “building” or “syncing”, let the process finish (may take several hours)</li></ul><li>Create a mount point for the array</li><ul><li>Sudo mkdir /media/RAIDStorage</li></ul><li>Modify fstab to mount partition on boot</li><ul><li>Sudo nano /etc/fstab</li><li>Add a new line:</li><ul><li>/dev/md0 /media/RAIDStorage  ext4 defaults   0    0</li></ul><li>Save and exit</li><li>Remount</li><ul><li>Sudo mount –a</li></ul><li>Check device was mounted to /media/RAIDStorage</li><ul><li>Sudo mount | grep RAIDStorage</li></ul></ul><li>Share RAIDStorage with NFS</li><ul><li>Sudo apt-get install nfs-kernel-server</li></ul><li>Edit exports file</li><ul><li>Sudo nano /etc/exports</li><li>Add line</li><ul><li>/media/Storage/Case_Data 10.1.1.0/24(rw,insecure,async,no_subtree_check)</li></ul><li>Save and exit</li><ul><li>/etc/init.d/nfs-kernel-server restart</li></ul></ul></ul>In this case, permissions are NOT being set up on NFS. If you need a more secure environment, make sure you set it up.<br /><br />Also, we are using 'async' instead of 'sync'. For some reason, when writing very large files sync have very, very bad performance, while async allowed for maximum write speeds.<br /><br />If there are write permission errors, check that the permissions on the folder (/media/RAIDStorage) on the server are set correctly for the user   