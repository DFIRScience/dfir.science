---
layout: single
title: "Using XARGS to speed up batch processing"
date: '2013-07-08T17:00:00.000+09:00'

tags:
- Hashing
- HowTo
modified_time: '2015-08-24T22:35:19.179+09:00'
blogger_id: tag:blogger.com,1999:blog-2701259639305045003.single-4149194603103814592
blogger_orig_url: https://DFIR.Science/2013/07/using-xargs-to-speed-up-batch-processing.html
---

[Edit 24/7/2013] Be careful when using xargs to spawn multiple processes that write to the same file. I've been using it with md5sum and piping the output to a file. In data sets with a large number of files, several hundred hashes would be missing in the final file. A more reliable way is to use md5deep.<br /><br /><br />In our last single we <a href="https://DFIR.Science/2013/07/md5sum-vs-md5deep-vs-openssl-md5-md5.html" target="_blank">compared md5sum, md5deep and openssl md5</a> to determine which is fastest at calculating different hashes. For that experiment we were using 1 thread. Essentially, a file comes in, it gets hashes, the next file comes in. With 1 threat, we saw 1 out of the 4 processors being used.<br /><br />However, if we are processing a list of files, why not split the work into multiple jobs and use all of the processors. md5deep does this by default (4 threads), but splitting the jobs for any task is easily done with xargs.<br /><br />xargs is a program that allows you to control arguments coming in from a pipe. For example, if we type 'find -type f | md5sum' then the list of found files would be hashed as one glob of data. To give each file name to md5sum, instead of <i>all</i>&nbsp;file names, we can use xargs to control how the output of find is piped to md5sum. For example, 'find -type f | xargs -n1 md5sum' will feed one line at a time to md5sum, allowing md5sum to find the file and hash it.<br /><br />You can also tell xargs how many threads to create using the -P switch. Since we have 4 processors, we will use 4 threads in this case.<br /><br />Consider in the last single, were the times for hashing all files in a directory were as follows:<br />md5sum:&nbsp;<span style="background-color: white; color: #333333; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14.44444465637207px; line-height: 21.111112594604492px; text-align: center;">real 3m46.117s</span><br />md5deep:&nbsp;<span style="background-color: white; color: #333333; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14.44444465637207px; line-height: 21.111112594604492px; text-align: center;">real 3m57.595s</span><br />openssl:&nbsp;<span style="background-color: white; color: #333333; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14.44444465637207px; line-height: 21.111112594604492px; text-align: center;">real 3m43.142s</span><br /><br />(example: 'find -type f | xargs -P4 -n1 md5sum')<br />Using xargs (and all of the processors), the real times can be reduced to:<br />md5sum: real&nbsp;1m57.196s<br />md5deep: real&nbsp;2m5.408s<br />openssl: real&nbsp;1m56.084s<br /><br />md5deep recursive, default threads (4), no xargs:<br />real<span class="Apple-tab-span" style="white-space: pre;"> </span>2m0.521s<br /><br />Note: the user and system time is the same as before because the same amount of processor time is being devoted to the tasks, however, there are more processors so the real time is much less.<br /><br />Also, consider that all the files in the directory are different sizes, with the largest being 10GB. The majority of the time for each program was spent with 1 thread hashing the largest file, while the other processors had already finished hashing all the other files.