---
layout: posts
title: Forensic Acquisition of a Virtual Machine with Access to the Host
date: '2012-07-15T04:06:00.001+09:00'
author: Joshua
tags:
- Digital Forensics
- Live Data Forensics
- dfir
- HowTo
modified_time: '2015-08-24T22:36:08.539+09:00'
thumbnail: http://4.bp.blogspot.com/-s0E4poWLg9o/T_JCkyQb1rI/AAAAAAAAAkk/yBzd3MZzubc/s72-c/ID-10018344.jpg
blogger_id: tag:blogger.com,1999:blog-2701259639305045003.single-6338215199415848782
blogger_orig_url: https://DFIR.Science/2012/07/forensic-acquisition-of-virtual-machine.html
---

Someone recently asked about an easy way to create a RAW image of virtual machine (VM) disks, so here is a quick how-to.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-s0E4poWLg9o/T_JCkyQb1rI/AAAAAAAAAkk/yBzd3MZzubc/s1600/ID-10018344.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="211" src="http://4.bp.blogspot.com/-s0E4poWLg9o/T_JCkyQb1rI/AAAAAAAAAkk/yBzd3MZzubc/s320/ID-10018344.jpg" width="320" /></a></div>If you have access to the VM host, you could either copy and <a href="http://digfor.blogspot.ie/2009/08/mounting-parallels-hdd-and-hds-files.html" target="_blank">convert</a> the virtual disks on the host using something like <a href="http://linux.die.net/man/1/qemu-img" target="_blank">qemu-img</a>, or&nbsp;if for some reason you cannot convert the virtual disks, you can image the VM from within the virtual environment. This how-to will go through&nbsp;relatively&nbsp;easy ways to image a live or offline virtual machine using the virtual environment with access to the host.<br /><br />First, if the virtual machine cannot be shut down (live environment),&nbsp;you will make changes to the 'suspect' environment. If it is a suspect device, make sure your tools are on write-protected media. Verification of disk images won't work in a live environment since the disk is changing while imaging is taking place. If you are doing and offline acquisition for forensic purposes, make sure you are <a href="http://synjunkie.blogspot.ie/2007/10/disk-imaging.html" target="_blank">verifying the images</a> once you create them.<br /><br /><b>If the VM is live and cannot be shut down:</b><br /><ul><li><span style="background-color: white;">Fist check if the management interface allows devices to be attached to the VM; specifically USB/Firewire devices.</span></li><ul><li><span style="background-color: white;">If you cannot attach devices for whatever reason, then you will have to use a network share or a <a href="http://www.lnx4n6.be/index.php?sec=Documentation&amp;page=netcatdd" target="_blank">netcat tunnel</a> to copy the image.</span></li><li><span style="background-color: white;">Ensure your storage media is larger than the Virtual Machine's disk</span></li></ul><li><span style="background-color: white;">If it is a Windows environment, copy your imaging program like </span><a href="http://accessdata.com/support/adownloads" style="background-color: white;" target="_blank">FTK Imager lite</a><span style="background-color: white;">, or dd.exe from </span><a href="http://unxutils.sourceforge.net/" style="background-color: white;" target="_blank">unxutils</a><span style="background-color: white;">,&nbsp;to the network share/USB device. I also like </span><a href="http://www.chrysocome.net/dd" style="background-color: white;" target="_blank">chrysocome's dd</a><span style="background-color: white;">&nbsp;since it lets you list devices.</span></li><li>In the Virtual Machine, mount your share/USB device</li><li>From the mounted device, you should be able to access and run the imaging tools you copied previously - ensure you output the image to your share/USB device.</li><ul><li><a href="http://www.forensicswiki.org/wiki/Dd" target="_blank">dd</a></li><li><a href="http://sploited.blogspot.ie/2012/04/first-time-ftk-imager-tutorial.html" target="_blank">FTK Imager Lite</a></li></ul></ul><div><br /></div><b>If the VM is offline or can be shut down:</b><br /><ul><li>First check if you can boot the VM from a CD/USB device</li><ul><li>If yes, use a live CD like <a href="http://www.lnx4n6.be/index.php?sec=Downloads&amp;page=bootcd" target="_blank">FCCU</a> or <a href="http://distrowatch.com/?newsid=05102" target="_blank">Helix</a>&nbsp;to boot the VM</li><ul><li>All we are really interested in is 1) an imaging program on the live CD and 2) USB or network support and 3) netcat installed.</li></ul><li>If no:</li><ul><li>Can you add CD/USB support to the VM?</li><li>Can you copy the VM, and convert to a RAW image using <a href="http://linux.die.net/man/1/qemu-img" target="_blank">qemu-img</a>&nbsp;(part of <a href="http://wiki.qemu.org/Main_Page" target="_blank">qemu</a>)?</li><li>Boot the VM, and make an image in the live environment (go to the live imaging section)</li></ul></ul><li>After you have booted the VM from a live CD...</li><ul><li>Using external storage to store the image:</li><ul><li>List the current disks - (fdisk -l) - and take note of the current suspect disks to image</li><ul><li>/dev/hda would be a physical disk, while /dev/hda1 would be partition 1 on disk 'a'</li></ul><li>Attach and mount an external storage disk</li><li>Make a copy of the physical disk (usually something like /dev/sda) using an imaging program like <a href="http://www.forensicswiki.org/wiki/Dd" target="_blank">dd</a> or <a href="http://guymager.sourceforge.net/" target="_blank">guymager</a>.</li><ul><li>Make sure you are copying the image to your external disk!</li></ul></ul><li>Using the network:</li><ul><li>Network share:</li><ul><li>List the current disks, and take note of the suspect disks to image</li><li>Mount the network share</li><li>Make a copy of the physical disk (usually something like /dev/sda) using an imaging program like&nbsp;<a href="http://www.forensicswiki.org/wiki/Dd" target="_blank">dd</a>&nbsp;or&nbsp;<a href="http://guymager.sourceforge.net/" target="_blank">guymager</a>.</li></ul><li>No network share:</li><ul><li>Set up a <a href="http://www.lnx4n6.be/index.php?sec=Documentation&amp;page=netcatdd" target="_blank">netcat tunnel</a>&nbsp;between a server (any computer you control), and the suspect VM (client)</li><ul><li>Note: this connection is unencrypted!!!</li></ul><li>You can use <a href="http://www.ndchost.com/wiki/server-administration/netcat-over-ssh" target="_blank">ssh</a> or <a href="http://sourceforge.net/projects/cryptcat/" target="_blank">cryptcat</a> to for an encrypted tunnel, and bzip for compression and <a href="http://www.ndchost.com/wiki/server-administration/netcat-over-ssh" target="_blank">faster transfer speeds</a>.</li></ul></ul></ul></ul><br />That's it. Pretty generic, but it should be enough to get anyone started. Please comment if you have any questions <br /><br /><a class="addthis_button" href="http://www.addthis.com/bookmark.php?v=250&amp;pubid=xa-50106e2f4b1c5322"><img alt="Bookmark and Share" height="16" src="http://s7.addthis.com/static/btn/v2/lg-share-en.gif" style="border: 0;" width="125" /></a><script src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-50106e2f4b1c5322" type="text/javascript"></script><br /><span style="font-size: small;">Image: <a href="http://www.freedigitalphotos.net/" target="_blank">FreeDigitalPhotos.net</a></span>